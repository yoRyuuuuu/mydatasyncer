# E2Eテスト実行計画

## 1. テスト対象の機能

`mydatasyncer` アプリケーションの以下の主要機能をテスト対象とします。

*   設定ファイル (`mydatasyncer.yml`) の読み込みと検証
*   データベース (MySQL) への接続
*   データファイル (CSV) の読み込みと解析
*   データベースへのデータ同期処理
*   Dry Run モードでの動作確認

## 2. テストシナリオ

以下のシナリオを想定してテストケースを作成します。

### 正常系シナリオ

*   有効な設定ファイルとデータファイルを使用して、データが正しくデータベースに同期されること。
*   Dry Run モードで実行した場合、同期処理がプレビューされ、実際のデータベースには変更が適用されないこと。
*   異なるデータ量（少量、中量、大量）での同期処理が正常に完了すること。
*   特定のカラムマッピングが正しく動作すること。

### 異常系シナリオ

*   設定ファイルが存在しない、または形式が不正な場合にエラーが発生すること。
*   データベース接続情報が不正な場合にエラーが発生すること。
*   データファイルが存在しない、または形式が不正な場合にエラーが発生すること。
*   データ同期中に予期せぬエラー（例: データ型不一致、ユニーク制約違反など）が発生した場合に、適切に処理されること。
*   必須パラメータが不足している場合にエラーが発生すること。

## 3. テスト環境の準備

*   **テスト用データベース:**
    *   Docker Compose (`compose.yml` を利用) を使用して、テスト実行時にMySQLコンテナを起動・停止します。
    *   テスト用の初期データ (`init-sql/` ディレクトリ内のSQLファイルなど) を用意し、テスト開始前にデータベースを初期状態にします。
*   **テスト用設定ファイル:**
    *   各テストシナリオに対応した複数の設定ファイル (`mydatasyncer.yml`) を用意します。
*   **テスト用データファイル:**
    *   各テストシナリオに対応した複数のCSVデータファイル (`testdata/` ディレクトリなど) を用意します。

## 4. テストの実装方針

*   Go言語の標準テストフレームワーク (`testing` パッケージ) を使用します。
*   テストケースは `main_test.go` ファイルに記述します。
*   各テストケースは、以下のステップで構成されます。
    1.  **準備 (Arrange):** テスト用データベースのセットアップ、テスト用設定ファイル・データファイルの準備。
    2.  **実行 (Act):** `mydatasyncer` コマンドを実行 (例: `RunApp` 関数を呼び出す)。
    3.  **検証 (Assert):** データベースの状態、コマンドの出力、ログなどを検証し、期待通りの結果であることを確認します。
*   テストの独立性を保つため、各テストケース実行前にデータベースの状態をリセットします。
*   ヘルパー関数を作成し、共通処理（データベース接続、ファイル読み込みなど）を共通化します。

## 5. テスト実行とレポート

*   `go test -v ./...` コマンドでテストを実行します。
*   テストカバレッジも計測し、必要に応じてテストケースを追加します (`go test -coverprofile=coverage.out && go tool cover -html=coverage.out`)。
